webpackJsonp([3],{S9wd:function(e,t){},mucz:function(e,t){},undV:function(e,t,s){"use strict";var c={props:{selectedWorkFlows:{type:Array,default:function(){return[]}},item:{type:Object,default:function(){return{}}}},computed:{WorkFlowIDs:function(){return this.selectedWorkFlows.map(function(e){return e.WorkFlowID})},checked:function(){return this.WorkFlowIDs.includes(this.item.WorkFlowID)}}},n={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"person-select-list"},[s("div",{staticClass:"person-select-item title"},[s("p",{staticClass:"text"},[e._v(e._s(e.item.WorkFlowName))])]),e._v(" "),s("div",{staticClass:"person-select-item select-box"},[s("div",{staticClass:"check-icon-wrap"},[s("div",{staticClass:"vux-check-icon"},[e.checked?s("i",{staticClass:"weui-icon weui_icon_success weui-icon-success"}):e._e(),e._v(" "),e.checked?e._e():s("i",{staticClass:"weui-icon weui_icon_circle weui-icon-circle"})])])])])},staticRenderFns:[]};var o=s("VU/8")(c,n,!1,function(e){s("S9wd")},null,null);t.a=o.exports},wdYJ:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=s("Gu7T"),n=s.n(c),o=s("mvHQ"),i=s.n(o),r=s("woOf"),a=s.n(r),l=s("Dd8w"),d=s.n(l),u=s("NYxO"),h=s("GUsc"),f=s("undV"),p=s("W/7t"),v=s("ALGc"),k=s("rHil"),C=s("N8Hv"),S={name:"workflow",data:function(){return{sendResultInfo:{},showPeopleContent:!0,MindInfo:"",IsMindMustInput:!0,NextNodeList:[],current:{},currentUserList:[],currentNodeCode:""}},computed:{PeopleContentHeight:function(){return this.showPeopleContent?"calc(60% - 50px)":"0px"},query:function(){return this.$router.history.current.query},formState:function(){return this.query.FormState}},mounted:function(){this.workNodeLoad()},methods:d()({workNodeLoad:function(){this.query.flowOperate&&this.getSelectPeople()},getSelectPeople:function(){var e=this,t=a()({},{WorkInfoID:this.query.WorkInfoID,FormId:this.query.FormId,KeyWord:this.query.KeyWord,KeyValue:this.query.KeyValue,SequeID:this.query.SequeID});this.query.WorkInfoID&&(t=a()(t,{WorkInfoID:this.query.WorkInfoID})),this.query.GroupID&&(t=a()(t,{GroupID:this.query.GroupID}));var s={Current:t,FlowOperate:p.d.SupplyInstance,SubOperate:"ReadSendNodeList"};this.FlowActionData(i()(s)).then(function(t){var s=t.data.value,c=[];s&&(e.sendResultInfo=a()({},s),c=s.NextNodeList.concat()),e.current=a()({},s.Current),e.NextNodeList=e.formatNextNodeList(c)}).catch(function(t){e.AlertShowEvent(t.message)})},submitFlow:function(){var e=this,t=this.getSelectedNode();if(""!==t.error)return this.AlertShowEvent(t.error),!1;if(this.IsMindMustInput&&""===this.MindInfo)return this.AlertShowEvent("审批意见不许为空"),!1;var s=a()(this.current,{KeyWord:this.query.KeyWord,KeyValue:this.query.KeyValue,FormId:this.query.FormId}),c=a()({Current:s,FlowOperate:"Send",MindInfo:this.MindInfo,SelectedNode:t.data,VoteText:"",VoteValue:""});this.FlowActionData(i()(c)).then(function(t){e.ToastShowEvent("完成提交"),e.GetInformCount().then(function(){e.timer&&clearTimeout(e.timer),e.timer=setTimeout(function(){"view"===e.formState?e.$router.push("/workinfos"):e.$router.back()},1e3)}).catch(function(t){e.AlertShowEvent(t)})}).catch(function(t){e.AlertShowEvent(t.message)})},selectCopyUsersEvent:function(e,t){var s=[].concat(n()(this.NextNodeList));s[e].checked?s[e].CanSelectCopyUsers[t].checked=!s[e].CanSelectCopyUsers[t].checked:this.AlertShowEvent("请先选择"+this.NextNodeList[e].NodeName+"节点"),this.NextNodeList=[].concat(n()(s))},selectUsersEvent:function(e,t){var s=[].concat(n()(this.NextNodeList)),c=s[e].checked,o=s[e].AllowMulitUser,i=s[e].SelectUserMode;if(c){if("SelectAllAndDisabled"===i)return this.AlertShowEvent("你没有修改权限"),!1;o?s[e].CanSelectUsers[t].checked=!s[e].CanSelectUsers[t].checked:s[e].CanSelectUsers.forEach(function(e,s){e.checked=s===t&&!e.checked})}else this.AlertShowEvent("请先选择"+s[e].NodeName+"节点");this.NextNodeList=[].concat(n()(s))},nodeListTitleSelect:function(e){var t=this,s=this.NextNodeList,c=s[e].checked,o=s[e].SelectNodeMode,i=s[e].LineType,r=s[e].IsLastReturnNode;switch(o){case"SelectedNode":s[e].checked=!c,s[e]=a()(s[e],this.computedUserIsSelected(s[e])),i===p.c.ExcludeLine&&s.forEach(function(c,n){n!==e&&(s[n].checked=!1,s[n]=a()(s[n],t.computedUserIsSelected(s[n])))}),r&&s.forEach(function(c,n){n!==e&&(s[n].checked=!1,s[n]=a()(s[n],t.computedUserIsSelected(s[n])))});break;case"SelectedAndDisabled":this.AlertShowEvent("禁止取消");break;default:s[e].checked=!c,s[e]=a()(s[e],this.computedUserIsSelected(s[e])),i===p.c.ExcludeLine&&s.forEach(function(c,n){n!==e&&(s[n].checked=!1,s[n]=a()(s[n],t.computedUserIsSelected(s[n])))}),r&&s.forEach(function(c,n){n!==e&&(s[n].checked=!1,s[n]=a()(s[n],t.computedUserIsSelected(s[n])))})}this.NextNodeList=[].concat(n()(s))},getSelectedNode:function(){var e=[],t="";return this.NextNodeList.forEach(function(s,c){var n={};n.NodeCode=s.NodeCode,n.SendUserList=[],n.CopyUserList=[],s.checked&&(s.CanSelectUsers.forEach(function(e,t){if(e.checked&&!0===e.checked){var s=a()({},e);delete s.checked,n.SendUserList.push(s)}}),s.CanSelectCopyUsers.forEach(function(e,t){if(e.checked&&!0===e.checked){var s=a()({},e);delete s.checked,n.CopyUserList.push(s)}}),0!==n.SendUserList.length||s.IsMustNotUsers||(t=s.NodeName+"节点没有选择送审人员"),s.checked&&e.push(n))}),0===e.length&&(t="节点数据为空,请选择一个节点"),{data:e,error:t}},formatNextNodeList:function(e){var t=this,s=[],c=[];return e.forEach(function(e,n){switch(e.IsMindMustInput&&c.push(e),e.SelectNodeMode){case"SelectedNode":e.IsLastReturnNode?e.checked=!1:e.checked=!0,e=a()(e,t.computedUserIsSelected(e));break;case"SelectedAndDisabled":e.checked=!0,e=a()(e,t.computedUserIsSelected(e));break;default:e.checked=!1,e=a()(e,t.computedUserIsSelected(e))}!e.IsCancel&&s.push(e)}),1===s.length&&(s[0].checked=!0),c.length>0?this.IsMindMustInput=!0:this.IsMindMustInput=!1,s},computedUserIsSelected:function(e){var t=e.CanSelectUsers||[],s=e.CanSelectCopyUsers||[];switch(e.SelectUserMode){case"DeselectAll":t.forEach(function(e,t){e.checked=!1});break;case"SelectAll":case"SelectAllAndDisabled":t.forEach(function(t,s){e.checked?t.checked=!0:t.checked=!1});break;default:t.forEach(function(s,c){e.checked&&1===t.length?s.checked=!0:s.checked=!1})}return s.forEach(function(t,c){e.checked&&1===s.length?t.checked=!0:t.checked=!1}),{CanSelectUsers:t,CanSelectCopyUsers:s}},cancel:function(){this.$router.back()},openUserBlock:function(e){this.currentUserList=[].concat(n()(e.CanSelectUsers)),this.currentNodeCode=e.NodeCode,this.$refs.positionUserList.load()},completeSelectUser:function(e){var t=this,s=[].concat(n()(this.NextNodeList));s.forEach(function(s){s.NodeCode===t.currentNodeCode&&(s.CanSelectUsers=[].concat(n()(e)))}),this.NextNodeList=[].concat(n()(s)),this.currentNodeCode="",this.currentUserList=[]},_judgeIsByDraft:function(e){if(!this.sendResultInfo.IsAllPass)return!1;switch(e.SendUserMode){case p.e.Normal:return!1;case p.e.ByDraft:return!0;case p.e.BySendUser:default:return!1}},_defineShowName:function(e){return e.CanSelectUsers.length>0?"二次筛选":"选择人员"}},Object(u.b)(["GetInformCount","FlowActionData","AlertShowEvent","ToastShowEvent"])),destroyed:function(){this.timer&&clearTimeout(this.timer)},components:{PersonSelectList:f.a,XTextarea:v.a,Group:k.a,CheckIcon:C.default,PositionUserList:h.a}},m={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("transition",{attrs:{name:"slide"}},[s("div",{staticClass:"work-node-select"},[s("div",{staticClass:"after-select-content"},[s("div",{staticClass:"people-select"},[s("header",{staticClass:"header"},[s("div",{staticClass:"title"},[e._v("人员选择")]),e._v(" "),s("div",{staticClass:"toggle-bar"},[s("cube-switch",{staticClass:"toggle-switch",model:{value:e.showPeopleContent,callback:function(t){e.showPeopleContent=t},expression:"showPeopleContent"}})],1)]),e._v(" "),s("section",{staticClass:"people-content",style:{height:e.PeopleContentHeight}},e._l(e.NextNodeList,function(t,c){return s("div",{key:c,staticClass:"next-node-list"},[s("h1",{staticClass:"node-list-title",on:{click:function(t){e.nodeListTitleSelect(c)}}},[s("div",{staticClass:"name"},[e._v(e._s(t.NodeName))]),e._v(" "),s("div",{staticClass:"check-box"},[s("check-icon",{attrs:{checked:t.checked}})],1)]),e._v(" "),t.CanSelectUsers.length>0?s("div",{staticClass:"next-node-list-unit can-select-users"},[s("h1",{staticClass:"title"},[s("span",[e._v("可送审人员")]),e._v(" "),e._judgeIsByDraft(t)?s("span",{staticClass:"add-btn",on:{click:function(s){e.openUserBlock(t)}}},[e._v("\n                  "+e._s(e._defineShowName(t))+"\n                ")]):e._e()]),e._v(" "),s("ul",{staticClass:"people-lists"},e._l(t.CanSelectUsers,function(t,n){return s("li",{key:t.UserID,staticClass:"people-list",on:{click:function(t){e.selectUsersEvent(c,n)}}},[s("div",{staticClass:"user-name"},[e._v(e._s(t.UserName))]),e._v(" "),s("div",{staticClass:"check-box"},[s("check-icon",{attrs:{checked:t.checked}})],1)])}))]):e._e(),e._v(" "),t.CanSelectCopyUsers.length>0?s("div",{staticClass:"next-node-list-unit can-select-copy-users"},[s("h1",{staticClass:"title"},[e._v("可抄送人员")]),e._v(" "),s("ul",{staticClass:"people-lists"},e._l(t.CanSelectCopyUsers,function(t,n){return s("li",{key:t.UserID,staticClass:"people-list",on:{click:function(t){e.selectCopyUsersEvent(c,n)}}},[s("div",{staticClass:"user-name"},[e._v(e._s(t.UserName))]),e._v(" "),s("div",{staticClass:"check-box"},[s("check-icon",{attrs:{checked:t.checked}})],1)])}))]):e._e()])})),e._v(" "),s("section",{staticClass:"approve-text-content"},[s("h1",{staticClass:"text-title"},[e._v("审批意见")]),e._v(" "),s("group",{staticClass:"textarea-content"},[s("x-textarea",{attrs:{name:"description",max:300,placeholder:"输入审批意见"},model:{value:e.MindInfo,callback:function(t){e.MindInfo="string"==typeof t?t.trim():t},expression:"MindInfo"}})],1)],1)]),e._v(" "),s("div",{staticClass:"person-select-bar"},[s("div",{staticClass:"select-bar",on:{click:e.cancel}},[s("span",[e._v("返回")])]),e._v(" "),s("div",{staticClass:"select-bar",on:{click:e.submitFlow}},[s("span",[e._v("提交")])])])]),e._v(" "),s("position-user-list",{ref:"positionUserList",attrs:{currentUserList:e.currentUserList},on:{complete:e.completeSelectUser}})],1)])},staticRenderFns:[]};var N=s("VU/8")(S,m,!1,function(e){s("mucz")},null,null);t.default=N.exports}});
//# sourceMappingURL=3.354014f2d23748574962.js.map