webpackJsonp([18],{"/hf0":function(t,e){},c1ZO:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=o("IHPB"),r=o.n(a),i=o("3cXf"),s=o.n(i),n=o("aA9S"),m=o.n(n),l=o("4YfN"),d=o.n(l),u=o("9rMa"),c=o("bGai"),f=o("gyMJ"),h=o("F4+m"),w=o("Mlu6"),v=o("6VRP"),p={name:"h5Form",mixins:[h.a,h.c],data:function(){return{currentIndex:0,switches:[],tabUnitWidth:100,mainformData:{},KeyWord:"",openformid:"",lineHeight:1.5,direction:"horizontal",computedWidth:{width:"400px"},formAllConfig:{},keywordright:{},workflowdata:{},afterSaveMsg:"",mx_isLoading:!1,mx_message:"",mx_alertShow:!1,mx_alertTitle:"提示",mx_toastShow:!1,mx_deleyTime:1e3}},computed:d()({switcheWidth:function(){return this.tabUnitWidth*this.switches.length+"px"}},Object(u.c)(["formStatus","routerParams","formStatusValue"])),created:function(){var t=this.$router.history.current.params;this.probeType=1,this.setFormStatus(t.formstate),this.setRouterParams(t)},mounted:function(){var t=this;this.$nextTick(function(){t.timer&&clearTimeout(t.timer),t.timer=setTimeout(function(){t.mainLoad()},500)})},methods:d()({mainLoad:function(){var t=this;this._FormInit(function(){t._FormMainLoad(),"add"!==t.routerParams.formstate&&t._FormData()})},saveFromData:function(t,e){var o=this,a=this.KeyWord,r=this.routerParams.formstate,i=Object(w.h)(this.formAllConfig.comboboxdata,this.mainformData,a),s={KeyWord:a,formAllConfig:this.formAllConfig,KeyWordType:"BO",data:[i],formDate:r,FormId:this.routerParams.FromId},n=Object(w.s)(s);this.MinXinHttpFetch(Object(f.j)(n),function(a){a.success&&(o.afterSaveMsg=e||"保存数据完成",o.mx_toastShow=!0,t&&t(),"add"===r&&o.$router.back())})},setFormDataFromConfig:function(t){var e=t.formTitle;document.title=e||"表单详情",this.switches=Object(w.t)(t),this.tabUnitWidth=140},_FormInit:function(t){var e=this,o=this.routerParams.Id,a=this.routerParams.formstate;if("add"===a&&(o=""),this.routerParams.FromId){var r={FormId:this.routerParams.FromId,KeyValue:o||"",FormState:a};this.MinXinHttpFetch(Object(f.h)(r),function(o){if(o.success){var a=m()({},o.data);e.formAllConfig=Object(w.g)(a),e.keywordright=e.formAllConfig.keywordright,e.workflowdata=e.formAllConfig.workflowdata;var r=e.formAllConfig.formconfig.appconfig;if(r)e.KeyWord=r.KeyWord,e.setFormDataFromConfig(r),t&&t();else{var i=e.routerParams,s=i.FromId,n=i.formstate,l=i.Id;e.openPCForm(s,n,l)}}})}else this.$nextTick(function(){e.MixinAlertShowEvent("openformid is "+e.routerParams.FromId)})},openPCForm:function(t,e,o){var a="?FormId="+t+"&KeyValue="+o,r="/Form/ValidForm/650540a6-af98-4669-b1c3-925691912d79/"+e+"/"+o+"/"+v.Base64.encode(t)+a;window.open(r,"_self")},checkSwitchPermission:function(t,e,o,a){var r=this,i=t.switchsPermission,s=t.switchs,n=this.routerParams.formstate;this.tabUnitWidth=t.tabUnitWidth,s=Object(w.n)(s,i,e,n,o,a),this.switches=Object(w.t)(s,t),this.timer=setTimeout(function(){r.$refs.navBarScroll.refresh()},200)},_FormMainLoad:function(){var t=this,e=this.routerParams.Id,o=this.routerParams.formstate;"add"===o&&(e="");var a={KeyWord:this.KeyWord,KeyValue:e,KeyWordType:"BO",swhere:"",select:"",formstate:o};this.MinXinHttpFetch(Object(f.i)(a),function(e){if(e.success){var a=t.formAllConfig.formconfig.config.joindata.statusfield,r=e.data.value,i=JSON.parse(r),s=i[a];if(t.setFormStatusValue(s),t.actionMenu=Object(w.A)(t.workflowdata,o,s),r||""!==r){var n=Object(w.i)(t.formAllConfig.comboboxdata,i,t.KeyWord);t.mainformData=m()({},n)}}})},_Exec:function(t,e,o){var a=this,r=m()({},t.condition.dataParams),i=t.field;r.MethodParams[i]=e[i],this.MinXinHttpFetch(Object(f.e)(s()(r)),function(t){if(t.success){var e=t.data.value;o&&o(e)}else o&&o(),a.MixinAlertShowEvent(t.message)})},_FormData:function(){var t=this,e={FormId:this.routerParams.FromId,KeyValue:this.routerParams.Id,extparams:""};this.MinXinHttpFetch(Object(f.g)(e),function(e){if(e.success){var o=e.data.value;[].concat(r()(o.children)).forEach(function(e,o){e.values||(e.values=[]),t.switches.forEach(function(t,o){t.KeyWord===e.KeyWord&&(t.data=m()({},e))})})}})},upDateForm:function(t,e){var o=this,a=this.KeyWord,r=this.routerParams.formstate,i=Object(w.h)(this.formAllConfig.comboboxdata,this.mainformData,a),n={KeyWord:a,formAllConfig:this.formAllConfig,KeyWordType:"BO",data:[i],formDate:r,FormId:this.routerParams.FromId},m=Object(w.s)(n),l={};this.workflowdata&&"view"===r?l.IsWorkFlowHuman="1":"add"===r&&(l.IsRegHuman="1");var d={OpenTrans:"true",Update:{MessageCode:"Power.Controls.PMS.SaveWebForm",data:{formId:m.FormId,json:JSON.parse(m.JsonData),params:v.Base64.encode(s()(l)),FlowOperate:"Update"}}};this.MinXinHttpFetch(Object(f.a)(s()(d)),function(a){a.success&&(o.afterSaveMsg=e||"数据更新完成",o.mx_toastShow=!0,t&&t())})},selectActionMenu:function(t){var e=this,o=this.routerParams,a=o.formstate,r=o.Id,i=o.FromId;if(!t)return!1;if(t.value&&"SaveForm"===t.value&&this.saveFromData(function(){e.mainLoad()}),t.value&&"Active"===t.value&&this.upDateForm(function(){var t={KeyWord:e.KeyWord,KeyValue:r,FormId:i,flowOperate:"Active",SequeID:e.workflowdata.CanFlowOperate.SequeID,FormState:a};e.$router.push({path:"/forkflow/active",query:t})},"更新数据完毕"),t.value&&"Send"===t.value&&this.upDateForm(function(){var t={KeyWord:e.KeyWord,KeyValue:r,FormId:i,flowOperate:"Send",SequeID:e.workflowdata.CanFlowOperate.SequeID,WorkInfoID:e.workflowdata.CanFlowOperate.CanFlowList.ShowMonitor.WorkInfoID,FormState:a};e.$router.push({path:"/forkflow/agree",query:t})},"更新数据完毕"),t.value&&"GetBack"===t.value&&this.upDateForm(function(){var t=m()({},{Current:{KeyWord:e.KeyWord,KeyValue:r,FormId:i,SequeID:e.workflowdata.CanFlowOperate.SequeID+"",FormState:a},FlowOperate:"GetBack"});e.MinXinHttpFetch(Object(f.f)(s()(t)),function(t){t.success&&e.mainLoad()})},"更新数据完毕"),t.value&&"ShowMonitor"===t.value){var n={flowOperate:"ShowMonitor",WorkInfoID:this.workflowdata.CanFlowOperate.CanFlowList.ShowMonitor.WorkInfoID};this.$router.push({path:"/forkflow/monitor",query:n})}if(t.value&&"Return"===t.value&&this.upDateForm(function(){var t={KeyWord:e.KeyWord,KeyValue:r,FormId:i,SequeID:e.workflowdata.CanFlowOperate.SequeID,FormState:a};e.$router.push({path:"/forkflow/return",query:t})},"更新数据完毕"),t.value&&"Delegate"===t.value&&this.upDateForm(function(){var t={KeyWord:e.KeyWord,KeyValue:r,FormId:i,SequeID:e.workflowdata.CanFlowOperate.SequeID,FormState:a};e.$router.push({path:"/forkflow/delegate",query:t})},"更新数据完毕"),t.value&&"Delegateing"===t.value&&this.upDateForm(function(){var t={KeyWord:e.KeyWord,KeyValue:r,FormId:i,SequeID:e.workflowdata.CanFlowOperate.SequeID,FormState:a};e.$router.push({path:"/forkflow/delegateing",query:t})},"更新数据完毕"),t.value&&"Stop"===t.value&&this.upDateForm(function(){var t={KeyWord:e.KeyWord,KeyValue:e.routerParams.Id,FormId:e.routerParams.FromId,SequeID:e.workflowdata.CanFlowOperate.SequeID,FormState:a};e.$router.push({path:"/forkflow/stop",query:t})},"更新数据完毕"),t.value&&"ShowHistoryMonitor"===t.value){var l={KeyWord:this.KeyWord,KeyValue:this.routerParams.Id,FormId:this.routerParams.FromId,SequeID:this.workflowdata.CanFlowOperate.SequeID,FormState:a};this.$router.push({path:"/forkflow/history",query:l})}},formRowChange:function(t){this.mainformData[t.field]=t.value},switchItem:function(t){this.currentIndex=t},_isShow:function(t){return this.currentIndex===t}},Object(u.d)({setFormStatus:"SET_FORM_STATUS",setRouterParams:"SET_ROUTER_PARAMS",setFormStatusValue:"FORMSTATUSVALUE"})),components:{FormRow:c.g,FormAction:c.e,commonChildTable:c.r,treeGridChildTable:c.t,treeGridChildTableCustomize:c.u}},F={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("transition",{attrs:{name:"slide"}},[o("div",{ref:"mainForm",staticClass:"main-form"},[o("header",{staticClass:"nav-bar nav-header"},[t.switches.length>0?o("nav-list",{ref:"navBarScroll",staticClass:"nav-bar-scroll",attrs:{"probe-type":t.probeType,data:t.switches,direction:t.direction,unitWidth:t.tabUnitWidth}},[o("div",{staticClass:"nav-scroll-inner"},[o("switches-box",{attrs:{switcheWidth:t.switcheWidth,lineHeight:t.lineHeight,switches:t.switches,currentIndex:t.currentIndex},on:{switch:t.switchItem}})],1)]):t._e()],1),t._v(" "),t.switches.length>0?o("div",{staticClass:"form-content"},t._l(t.switches,function(e,a){return o("div",{directives:[{name:"show",rawName:"v-show",value:t._isShow(a),expression:"_isShow(tableIndex)"}],key:a,class:"form-content-item "+e.type},["mainTable"===e.type?o("div",{staticClass:"main-table-item",attrs:{for:"主表"}},[o("form",{staticClass:"input-textarea-group"},t._l(e.tableShowField,function(a){return e.tableShowField.length>0&&""!==t.KeyWord?o("form-row",{key:a.field,attrs:{label:a.title,type:a.format,readonly:a.readonly,required:a.required,disabled:a.disabled,placeholder:a.placeholder,field:a.field,KeyWord:t.KeyWord,mainformData:t.mainformData,comboboxdata:t.formAllConfig.comboboxdata||{}},on:{enterChange:t.formRowChange}}):t._e()})),t._v(" "),t.actionMenu.length>0&&("40"!==t.formStatusValue||"50"!==t.formStatusValue)?o("div",{staticClass:"form-action-wrap"},[o("form-action",{attrs:{actions:t.actionMenu},on:{selectActionMenu:t.selectActionMenu}})],1):t._e()]):t._e(),t._v(" "),"childTable"===e.type?o("div",{directives:[{name:"show",rawName:"v-show",value:t._isShow(a),expression:"_isShow(tableIndex)"}],class:"form-content-item "+e.type,attrs:{for:"子表list"}},[!e.data||"common"!==e.style&&e.style?t._e():o("common-child-table",{attrs:{for:"common",KeyValue:t.routerParams.Id,formAllConfig:t.formAllConfig,comboboxdata:t.formAllConfig.comboboxdata,chileTableItem:e,tableData:e.data,mainformData:t.mainformData},on:{saveChildFrom:function(e){t._FormData()}}}),t._v(" "),e.data&&"treeGrid"===e.style?o("tree-grid-child-table",{attrs:{KeyValue:t.routerParams.Id,formAllConfig:t.formAllConfig,openformid:t.openformid,comboboxdata:t.formAllConfig.comboboxdata,chileTableItem:e,tableData:e.data,mainformData:t.mainformData},on:{saveChildFrom:function(e){t._FormData()}}}):t._e(),t._v(" "),e.data&&"treeGridCustomize"===e.style?o("tree-grid-child-table-customize",{attrs:{KeyValue:t.routerParams.Id,formAllConfig:t.formAllConfig,openformid:t.openformid,comboboxdata:t.formAllConfig.comboboxdata,chileTableItem:e,tableData:e.data,mainformData:t.mainformData},on:{saveChildFrom:function(e){t._FormData()}}}):t._e()],1):t._e(),t._v(" "),"fileAttach"===e.type?o("div",{directives:[{name:"show",rawName:"v-show",value:t._isShow(a),expression:"_isShow(tableIndex)"}],staticClass:"form-content-item file-attach",attrs:{for:"附件"}},[o("file-attach",{attrs:{loadStart:t.currentIndex===a,KeyWord:t.KeyWord,KeyValue:t.routerParams.Id}})],1):t._e(),t._v(" "),"report"===e.type?o("div",{directives:[{name:"show",rawName:"v-show",value:t._isShow(a),expression:"_isShow(tableIndex)"}],staticClass:"form-content-item",attrs:{for:"报表"}},[o("report",{ref:"Report",refInFor:!0,attrs:{loadStart:t.currentIndex===a,KeyWord:t.KeyWord}})],1):t._e(),t._v(" "),"comment"===e.type?o("div",{directives:[{name:"show",rawName:"v-show",value:t._isShow(a),expression:"_isShow(tableIndex)"}],staticClass:"form-content-item",attrs:{for:"评论"}},[o("comment",{attrs:{loadStart:t.currentIndex===a,KeyWord:t.KeyWord}})],1):t._e()])})):t._e(),t._v(" "),o("loading",{model:{value:t.mx_isLoading,callback:function(e){t.mx_isLoading=e},expression:"mx_isLoading"}}),t._v(" "),o("toast",{attrs:{type:"text",time:t.mx_deleyTime},model:{value:t.mx_toastShow,callback:function(e){t.mx_toastShow=e},expression:"mx_toastShow"}},[t._v(t._s(t.afterSaveMsg))]),t._v(" "),o("alert",{attrs:{title:t.mx_alertTitle,content:t.mx_message},on:{"on-hide":t.MixinAlertHideEvent},model:{value:t.mx_alertShow,callback:function(e){t.mx_alertShow=e},expression:"mx_alertShow"}})],1)])},staticRenderFns:[]};var y=o("C7Lr")(p,F,!1,function(t){o("/hf0")},null,null);e.default=y.exports}});
//# sourceMappingURL=18.835558cb47ce9245b0c2.js.map