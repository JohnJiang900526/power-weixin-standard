webpackJsonp([13],{Z5zp:function(t,e){},mVYI:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("3cXf"),n=s.n(i),c=s("aA9S"),o=s.n(c),a=s("4YfN"),r=s.n(a),d=s("9rMa"),l=s("tiSE"),u=s("N8Hv"),h=s("RAwi"),f=s("CKVb"),m=s("F4+m"),v=s("gyMJ"),_={name:"workflow",mixins:[m.a],data:function(){return{query:{},formState:"",method:[{text:"正常驳回",Code:"Normal",checked:!0},{text:"直接送还本节点(点对点)",Code:"MustSendCurrent",checked:!1},{text:"正常驳回，且收件人只能常规发送",Code:"MustReturnAndNormal",checked:!1}],NextNodeList:[],HistoryMind:[],MindInfo:"",Current:{},afterSaveMsg:"",mx_isLoading:!1,mx_message:"",mx_alertShow:!1,mx_alertTitle:"提示",mx_toastShow:!1,mx_deleyTime:1e3}},mounted:function(){this.getReturnData()},methods:r()({submitData:function(){var t=this,e=this.MindInfo,s=this.getSelectedNodeData(),i=this.valiData(e,s);if(!i.pass)return this.MixinAlertShowEvent(i.msg),i.pass;var c=o()({},{FlowOperate:"Return",Current:this.Current,MindInfo:this.MindInfo,SelectedNode:s.concat()});this.MinXinHttpFetch(Object(v.f)(n()(c)),function(e){e.success&&(t.afterSaveMsg="驳回成功",t.mx_toastShow=!0,t.GetInformCount().then(function(){t.timer&&clearTimeout(t.timer),t.timer=setTimeout(function(){"view"===t.formState?t.$router.push("/workinfos"):t.$router.back()},1e3)}).catch(function(e){t.AlertShowEvent(e.message)}))})},valiData:function(t,e){var s={msg:"",pass:!0};return t&&""!==t?e&&0!==e.length?(e.forEach(function(t,e){var i=t.ItemList;if(!i||0===i.length)return s.msg="人员节点列不能为空",s.pass=!1,s;i.forEach(function(t,e){var i=t.UserList;if(!i||0===i.length)return s.msg="选择人员不能为空",s.pass=!1,s})}),s):(s.msg="人员节点不能为空",s.pass=!1,s):(s.msg="意见不能为空",s.pass=!1,s)},getSelectedNodeData:function(){var t=this,e=[];return this.NextNodeList.concat().forEach(function(s,i){var n={};s.checked&&(n.NodeCode=s.NodeCode,n.NodeName=s.NodeName,n.ReturnedSendMode=t.getSelectedMethod(),n.ItemList=[],s.ItemList.forEach(function(t,e){var s=t.UserList,i=o()({},t);i.UserList=[],i.OtherUserList=[],s.forEach(function(t,e){var s=o()({},t);t.checked&&(delete s.checked,i.UserList.push(s))}),n.ItemList.push(i)}),e.push(n))}),e},getSelectedMethod:function(){for(var t=this.method,e="Normal",s=0;s<t;s++)if(t[s].checked){e=t[s].Code;break}return e},getReturnData:function(){var t=this;this.getQuery();var e=o()({},{SubOperate:"ReadReturnNodeList",SequeID:this.query.SequeID,FlowOperate:"SupplyInstance",Current:this.query});this.MinXinHttpFetch(Object(v.f)(n()(e)),function(e){if(e.success){var s=e.data.value,i=s.NextNodeList.concat();t.Current=o()({},s.Current),t.NextNodeList=t.formatNextNodeList(i),t.HistoryMind=s.HistoryMind.concat()}})},switchMethods:function(t){this.method.forEach(function(e,s){e.checked=s===t})},formatNextNodeList:function(t){return t.forEach(function(e,s){1===t.length?e.checked=!0:e.checked=!1,e.ItemList.forEach(function(t,s){var i=t.UserList;i.forEach(function(t,s){e.checked&&1===i.length?t.checked=!0:t.checked=!1})})}),t},selectedUser:function(t,e,s){var i=this.NextNodeList.concat();i[t].ItemList[e].UserList[s].checked=!i[t].ItemList[e].UserList[s].checked,this.NextNodeList=i.concat()},selectedNodeEvent:function(t){var e=this.NextNodeList.concat();e[t].checked=!e[t].checked,e[t].checked?e[t].ItemList[0].UserList.forEach(function(s){var i=e[t].ItemList[0].UserList.length;s.checked=1===i}):e[t].ItemList[0].UserList.forEach(function(t){t.checked=!1}),this.NextNodeList=e.concat()},goBack:function(){this.$router.back()},getQuery:function(){var t=this.$router.history.current.query;t&&(this.query=o()({},t),this.formState=this.query.FormState)}},Object(d.b)(["GetInformCount","AlertShowEvent"])),components:{LineBreak:l.default,CheckIcon:u.default,XTextarea:h.a,Group:f.a}},k={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("transition",{attrs:{name:"slide"}},[s("div",{staticClass:"work-flow-return"},[s("div",{staticClass:"flow-return-content"},[s("div",{staticClass:"return-content"},[s("h1",{staticClass:"title font-color-active"},[t._v("人员选择:")]),t._v(" "),t._l(t.NextNodeList,function(e,i){return s("div",{key:i,staticClass:"return-user-row"},[s("h1",{staticClass:"row-title",on:{click:function(e){t.selectedNodeEvent(i)}}},[s("div",{staticClass:"text font-color-active"},[t._v(t._s(e.NodeName))]),t._v(" "),s("div",{staticClass:"icon"},[s("check-icon",{attrs:{checked:e.checked}})],1)]),t._v(" "),t._l(e.ItemList,function(e,n){return s("ul",{key:n,staticClass:"row-lists"},t._l(e.UserList,function(e,c){return s("li",{key:c,staticClass:"row-list",on:{click:function(e){t.selectedUser(i,n,c)}}},[s("div",{staticClass:"row-list-inner"},[s("div",{staticClass:"text"},[t._v(t._s(e.UserName))]),t._v(" "),s("div",{staticClass:"icon"},[s("check-icon",{attrs:{checked:e.checked}})],1)])])}))})],2)})],2),t._v(" "),s("div",{staticClass:"method-content"},[s("h1",{staticClass:"title font-color-active"},[t._v("发送模式:")]),t._v(" "),s("ul",{staticClass:"method-lists"},t._l(t.method,function(e,i){return s("li",{key:i,staticClass:"method-list",on:{click:function(e){t.switchMethods(i)}}},[s("div",{staticClass:"list-inner"},[s("div",{staticClass:"text"},[t._v("\n                "+t._s(e.text)+"\n              ")]),t._v(" "),s("div",{staticClass:"icon"},[s("check-icon",{attrs:{checked:e.checked}})],1)])])}))]),t._v(" "),s("div",{staticClass:"mind-info-content"},[s("h1",{staticClass:"title font-color-active"},[t._v("提交意见:")]),t._v(" "),s("group",{staticClass:"textarea-content"},[s("x-textarea",{attrs:{name:"description",max:300,placeholder:"输入驳回意见"},model:{value:t.MindInfo,callback:function(e){t.MindInfo="string"==typeof e?e.trim():e},expression:"MindInfo"}})],1)],1)]),t._v(" "),s("div",{staticClass:"flow-return-footer"},[s("div",{staticClass:"item",on:{click:t.submitData}},[t._v("\n        提交\n      ")]),t._v(" "),s("div",{staticClass:"item",on:{click:t.goBack}},[t._v("\n        返回\n      ")])]),t._v(" "),s("loading",{model:{value:t.mx_isLoading,callback:function(e){t.mx_isLoading=e},expression:"mx_isLoading"}}),t._v(" "),s("toast",{attrs:{type:"text",time:t.mx_deleyTime},model:{value:t.mx_toastShow,callback:function(e){t.mx_toastShow=e},expression:"mx_toastShow"}},[t._v(t._s(t.afterSaveMsg))]),t._v(" "),s("alert",{attrs:{title:t.mx_alertTitle,content:t.mx_message},on:{"on-hide":t.MixinAlertHideEvent},model:{value:t.mx_alertShow,callback:function(e){t.mx_alertShow=e},expression:"mx_alertShow"}})],1)])},staticRenderFns:[]};var x=s("C7Lr")(_,k,!1,function(t){s("Z5zp")},null,null);e.default=x.exports}});
//# sourceMappingURL=13.9111c0d0fb3afe5d99ee.js.map